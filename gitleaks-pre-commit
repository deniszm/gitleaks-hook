#!/bin/bash

set -e

echo "Running gitleaks security scan..."

if ! command -v gitleaks &> /dev/null; then
    echo "Error: gitleaks is not installed!"
    echo "Install: https://github.com/gitleaks/gitleaks#installing"
    exit 2
fi

if gitleaks git --pre-commit --staged --verbose --redact; then
    echo "No secrets detected. Commit allowed."
    exit 0
else
    echo "SECRETS DETECTED! Commit rejected."
    echo "Remove secrets before committing."
    exit 1
fi
